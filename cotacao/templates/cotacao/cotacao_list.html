{% extends "base.html" %}
{% load static %}
{% load cotacao_tags %}

{% block content %}
<div class="container mt-5">
    <h2 class="mb-3">Filtros de Cotação</h2>
    <form method="get" class="mb-4">
        <div class="row g-3">
            <div class="col-md-3">
                <label for="status_filter" class="form-label">Status</label>
                <select id="status_filter" name="status" class="form-control">
                    <option value="">Todos</option>
                    <option value="aberta">Aberta</option>
                    <option value="fechada">Fechada</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="from_date" class="form-label">De</label>
                <input type="date" id="from_date" name="from_date" class="form-control">
            </div>
            <div class="col-md-3">
                <label for="to_date" class="form-label">Até</label>
                <input type="date" id="to_date" name="to_date" class="form-control">
            </div>
            <div class="col-md-3">
                <label for="department_filter" class="form-label">Departamento</label>
                <select id="department_filter" name="department" class="form-control">
                    <option value="">Todos</option>
                    {% for departamento in departamentos %}
                    <option value="{{ departamento.id }}">{{ departamento.nome }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="mt-3 d-flex justify-content-end">
            <button type="submit" class="btn btn-secondary">Filtrar</button>
        </div>
    </form>

    <!-- <div class="d-flex justify-content-between mb-3">
        <a href="{% url 'cotacao:export_cotacoes_excel' %}" class="btn btn-info">Exportar Excel</a>
        <a href="{% url 'cotacao:export_cotacoes_pdf' %}" class="btn btn-info">Exportar PDF</a>
    </div> -->

    <div class="row text-center mb-3">
        <div class="col-md-4">
            <div class="alert alert-primary" role="alert">
                Total de Cotações: {{ cotacoes.count }}
            </div>
        </div>
        <div class="col-md-4">
            <div class="alert alert-success" role="alert">
                Cotações Abertas: {{ cotacoes|filter_status:'aberta'|length }}
            </div>
        </div>
        <div class="col-md-4">
            <div class="alert alert-danger" role="alert">
                Cotações Fechadas: {{ cotacoes|filter_status:'fechada'|length }}
            </div>
        </div>
    </div>

    <h2 class="mb-3">Cotações</h2>
    {% if cotacoes %}
    <div class="list-group">
        {% for cotacao in cotacoes %}
        <div class="list-group-item d-flex justify-content-between align-items-center py-3">
            <div class="flex-grow-1 ms-3">
                <a href="{% url 'cotacao:cotacao_detail' cotacao.pk %}" class="h5 text-decoration-none">
                    {{ cotacao.nome }}
                </a>
                <div><small>Status: {{ cotacao.status }}</small></div>
                <div><small>Prazo de Pagamento: {{ cotacao.prazo_pagamento }}</small></div>               
                <div><small>Data de Abertura: {{ cotacao.data_abertura|date:"d M Y" }}</small></div>
                <div><small>Data de Fechamento: {{ cotacao.data_fechamento|date:"d M Y" }}</small></div>
                <span class="badge bg-primary ms-2">{{ cotacao.departamento.nome }}</span>
            </div>
            <div class="btn-group">
                <!-- Botão de toggle status -->
                {% if cotacao.status == 'aberta' %}
                <a href="#" class="btn btn-outline-danger btn-sm">
                    Fechar Cotação
                </a>
                {% else %}
                <a href="#" class="btn btn-outline-success btn-sm">
                    Abrir Cotação
                </a>
                {% endif %}
                <!-- Outros botões -->
                <a href="{% url 'cotacao:enviar_cotacao' cotacao.pk %}" class="btn btn-outline-primary btn-sm mx-1">
                    <i class="bi bi-send"></i> Enviar
                </a>
                <a href="{% url 'cotacao:cotacao_delete' cotacao.pk %}" class="btn btn-outline-danger btn-sm mx-1">
                    <i class="bi bi-trash"></i> Deletar
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info text-center" role="alert">
        Nenhuma cotação encontrada.
    </div>
    {% endif %}
</div>
{% endblock %}